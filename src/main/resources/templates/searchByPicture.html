<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Drag & Drop Фотографій з можливістю видалення</title>
</head>
<style>
    .input-div {
        width: 100%;
        height: 200px;
        border-radius: 5px;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        border: 2px dotted black;
        background-color: white;
        position: relative;
    }

    .file {
        width: 100%;
        height: 100%;
        position: absolute;
        opacity: 0;
        cursor: pointer;
    }

    output {
        width: 100%;
        min-height: 150px;
        display: flex;
        justify-content: flex-start;
        flex-wrap: wrap;
        gap: 15px;
        position: relative;
        border-radius: 5px;
    }

    output .image {
        height: 150px;
        border-radius: 5px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);
        overflow: hidden;
        position: relative;
    }

    output .image img {
        height: 100%;
        width: 100%;
    }

    output .image span {
        position: absolute;
        top: -4px;
        right: 4px;
        cursor: pointer;
        font-size: 22px;
        color: white;
    }

    output .image span:hover {
        opacity: 0.8;
    }

    output .span--hidden {
        visibility: hidden;
    }
    .loader {
        display: none;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100px;
        height: 100px;
        border: 10px solid #f3f3f3;
        border-top: 10px solid #3498db;
        border-radius: 50%;
        animation: spin 2s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>

<body>
<div class="input-div">
    <p>Drag & drop photos here or <strong>Browse</strong></p>
    <input type="file" class="file" multiple="multiple" accept="image/jpeg, image/png, image/jpg">
</div>

<form>
    <button type="button" onclick="uploadFiles()">Submit</button>
</form>

<form th:action="@{/spotify/spotifyListEditor}" id="myForm">
    <input type="button" hidden="hidden">
</form>

<output></output>

<div class="loader"></div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    const inputDiv = document.querySelector(".input-div")
    const input = document.querySelector("input")
    const output = document.querySelector("output")
    let imagesArray = []
    const loader = document.querySelector(".loader")

    input.addEventListener("change", () => {
        const files = input.files
        for (let i = 0; i < files.length; i++) {
            imagesArray.push(files[i])
        }
        displayImages()
    })
    inputDiv.addEventListener("drop", (e) => {
        e.preventDefault()
        const files = e.dataTransfer.files
        for (let i = 0; i < files.length; i++) {
            if (!files[i].type.match("image")) continue;

            if (imagesArray.every(image => image.name !== files[i].name))
                imagesArray.push(files[i])
        }
        displayImages()
    })
    function displayImages() {
        let images = ""
        imagesArray.forEach((image, index) => {
            images += `<div class="image">
                <img src="${URL.createObjectURL(image)}" alt="image">
                <span onclick="deleteImage(${index})">&times;</span>
              </div>`
        })
        output.innerHTML = images
    }
    function deleteImage(index) {
        imagesArray.splice(index, 1)
        displayImages()
    }
    function uploadFiles() {
        // const form = document.querySelector();
        const formData = new FormData();

        for (let i = 0; i < imagesArray.length; i++) {
            formData.append('images', imagesArray[i]);
        }

        showLoader(); // показати анімацію завантаження

        fetch('/spotify/upload', {
            method: 'POST',
            body: formData
        })
            .then(data => {
                hideLoader(); // приховати анімацію завантаження
                console.log(data);
                window.location.href = '/spotify/spotifyListEditor'; // перенаправлення користувача
            });
    }
    function showLoader() {
        loader.style.display = "block";
    }
    function hideLoader() {
        loader.style.display = "none";
    }
</script>
</body>
</html>